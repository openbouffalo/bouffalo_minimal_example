#include "romdriver.h"
#define GLB_BASE         ((uint32_t)0x40000000)
#define GLB_GPIO_OUTPUT_OFFSET    0x188

static const uint8_t header[176] __attribute__((used,section(".header"))) = {
    0x42, 0x46, 0x4E, 0x50, 0x01, 0x00, 0x00, 0x00, 0x46, 0x43, 0x46, 0x47, 0x11, 0x00, 0x01, 0x01, 
    0x66, 0x99, 0xFF, 0x03, 0x9F, 0x00, 0x9F, 0x00, 0x04, 0xC2, 0x00, 0x01, 0xC7, 0x20, 0x52, 0xD8, 
    0x06, 0x02, 0x32, 0x00, 0x0B, 0x01, 0x0B, 0x01, 0x3B, 0x01, 0xBB, 0x00, 0x6B, 0x01, 0xEB, 0x02, 
    0xEB, 0x02, 0x02, 0x50, 0x00, 0x01, 0x00, 0x01, 0x01, 0x00, 0x02, 0x01, 0x02, 0x01, 0xAB, 0x01, 
    0x05, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x38, 0xFF, 0x00, 0xFF, 0x77, 0x03, 0x02, 0x40, 
    0x77, 0x03, 0x02, 0xF0, 0x2C, 0x01, 0xB0, 0x04, 0xB0, 0x04, 0x05, 0x00, 0xFF, 0xFF, 0x14, 0x00, 
    0x2A, 0x76, 0x3C, 0xE4, 0x00, 0x00, 0x00, 0x00, 0x01, 0x04, 0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 
    0xBA, 0x7D, 0x12, 0x72, 0x00, 0x03, 0x03, 0x00, 0xA8, 0xCD, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x20, 0x00, 0x00, 0xEF, 0xBE, 0xAD, 0xDE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0xEF, 0xBE, 0xAD, 0xDE, 
};

BL_Err_Type GLB_GPIO_Write(GLB_GPIO_Type gpioPin, uint32_t val)
{
    uint32_t *pOut = (uint32_t *)(GLB_BASE + GLB_GPIO_OUTPUT_OFFSET + ((gpioPin >> 5) << 2));
    uint32_t pos = gpioPin % 32;
    uint32_t tmpOut;

    tmpOut = *pOut;
    if (val > 0) {
        tmpOut |= (1 << pos);
    } else {
        tmpOut &= (~(1 << pos));
    }
    *pOut = tmpOut;

    return SUCCESS;
}

int main() {
	GLB_GPIO_Cfg_Type gpioCfg = {
        .gpioPin = GLB_GPIO_PIN_31,
        .gpioFun = 11,
        .gpioMode = 1,
        .pullType = 2,
        .drive = 0,
        .smtCtrl = 1
    };

    RomDriver_GLB_GPIO_Init(&gpioCfg);
    RomDriver_GLB_GPIO_OUTPUT_Enable(gpioCfg.gpioPin);
    while (1) {
		GLB_GPIO_Write(31, 1);
		RomDriver_BL702_Delay_MS(1000);
		GLB_GPIO_Write(31, 0);
		RomDriver_BL702_Delay_MS(1000);
    }
}